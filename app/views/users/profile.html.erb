<%= stylesheet_link_tag "user.css" %>

<div id="profile-div" style ="text-align: center; width: 80%; margin: auto">
	<h1> <%= @user.name %> </h1>
	<div id="user-info-div" class= shadow-box style="text-align: left; font-size: 18px">
		<b>Email:</b> <%= @user.email %><br>
		<b>Tel:</b> <%= @user.tel %><br>
		<b>Birthday:</b> <%= @user.bday %><br>
		<b>Role:</b> <%= @user.role %>
		<!--<b>Banned:</b> <%= @user.banned %>-->
	</div>
</div>

<% if user_signed_in? %>
	<div id="profile-buttons-div" class="d-flex flex-row" style ="text-align: center; width: fit-content; margin: auto; margin-top: 1%">
		<% if @user.id != current_user.id %>
			<% if @user.banned %>
				<% if @user.role == "moderator" %>
					<% if current_user.role == "admin" %>
						<%= link_to "Unban user", users_unban_user_path(:uid => @user.id), method: :get, class: "btn btn-dark me-2" %>
					<% end %>
				<% elsif @user.role != "admin" && (current_user.role == "admin" || current_user.role == "moderator") %>
					<%= link_to "Unban user", users_unban_user_path(:uid => @user.id), method: :get, class: "btn btn-dark me-2" %>
				<% end %>
			<% else %>
				<% if @user.role == "moderator" %>
					<% if current_user.role == "admin" %>
						<%= link_to "Ban user", users_ban_user_path(:uid => @user.id), method: :get, class: "btn btn-dark me-2" %>
					<% end %>
				<% elsif @user.role != "admin" && (current_user.role == "admin" || current_user.role == "moderator") %>
					<%= link_to "Ban user", users_ban_user_path(:uid => @user.id), method: :get, class: "btn btn-dark me-2" %>
				<% end %>
			<% end %>
			<% if @user.role == "user" %>
				<% if current_user.role == "admin" %>
					<%= link_to "Promote to moderator", users_promote_to_moderator_path(:uid => @user.id), method: :get, class: "btn btn-dark" %>
				<% end %>
			<% elsif current_user.role == "admin" && @user.role == "moderator" %>
				<%= link_to "Demote to user", users_demote_to_user_path(:uid => @user.id), method: :get, class: "btn btn-dark" %>
			<% end %>
		<% end %>
		<% if @user.id == current_user.id %>
			<button type="button" class="btn btn-dark" style="margin: 1px"><%= link_to "Edit account info", edit_user_registration_path, style: "text-decoration: none; color: white; font-size: 18px" %></button>
		<% end %>
	</div>
<% end %>
<br>

<div id="title-div" class="d-flex flex-row" style="width: 80%; margin: auto; text-align: center">
	<div style="flex: 48%; margin:auto">
		<h1>Reviews</h1>
	</div>
	<div style="flex: 48%; margin:auto">
		<h1>Favourite places</h1>
	</div>
</div>

<div id="bottom-div" class="d-flex flex-row" style="width: 80%; height: 50vh; margin: auto; text-align: center">
	
	<div id="reviews-div" class="shadow-box" style="width: 100%; max-height: 90%; height: fit-content; margin: 1%; overflow: auto">
		<% if @user.banned %>
			<p>This user is banned from posting reviews</p>
		<% else %>
 			<% @user.reviews.each do |r| %>
				<div class="shadow-box" style="text-align: left; font-size: 18px; margin-bottom: 2%; width: 100%">
					<%= render "reviews/review", review: r %>
				</div>
			<% end %> 
		<% end %>
	</div>

	<div id="favorites-div" class="shadow-box" style="width: 100%; max-height: 90%; height: fit-content; margin: 1%; overflow: auto">
		<% arr = @user.favourites.split(",") %>
		<div class="d-flex flex-row" style="display: flex; flex-wrap: wrap">
			<% arr.each do |f| %>
				<div class="d-flex flex-row shadow-box" style="flex: 48%; margin: 1%; max-width: 48%; width: 30vw; height: 10vh; padding: 0">
					<% response=HTTP.get("https://pixabay.com/api/", :params=>{:key=>"28482200-fa6da61f3cb68d66c0df9caf9", :q=>f, :lang=>"en", :category=>"places", :safesearch=>"true", :per_page=>"3"}) %>
					<% results=JSON.parse(response) %>
					<% @imageurl=results["hits"][0]["largeImageURL"] %>
					<div style="width: 40%; height: 100%; margin-right: 2%">
						<img src=<%= @imageurl %> width=100% height=100% style="border-radius: 5px 0px 0px 5px">
					</div>
					<div style="margin: auto; font-size: 24px">
						<!--<%= f %>-->
						<%=link_to "#{f}", {controller: "place", action: "getreviews", destinationplace: f}, {:style=>"text-decoration: none;color:black;"}%>
					</div>
					<%if user_signed_in? && current_user.id==@user.id%>
						<div style="margin: auto; font-size: 24px">
							<%=link_to "#{image_tag("delete.png", size:"20")}".html_safe, place_remove_from_favourites_path(:place => f, flash_notice:"Ok")%>
						</div>
					<%end%>
				</div>
			<% end %>
		</div>
	</div>

</div>